services:
  worker_0:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: operator-worker_0
    working_dir: /app
    stdin_open: true
    tty: true
    env_file:
      - ./agents/worker_0/.env
    environment:
      OPENCLAW_TRUSTED_PROXY_IPS: "172.28.0.2"
    volumes:
      - ./agents/worker_0/files:/app/files
      - ./agents/worker_0/config.js:/app/config.js:ro
    networks:
      operator_net:
        ipv4_address: 172.28.0.3

  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: openclaw-nginx
    depends_on:
      - worker_0
    ports:
      - "18789:80"
    env_file:
      - nginx.env
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    command:
      - /bin/sh
      - -c
      - printf '%s:%s\n' "$$PROXY_BASIC_AUTH_USER" "$$(openssl passwd -apr1 "$$PROXY_BASIC_AUTH_PASS")" > /etc/nginx/.htpasswd && exec nginx -g 'daemon off;'
    networks:
      operator_net:
        ipv4_address: 172.28.0.2

networks:
  operator_net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/24
